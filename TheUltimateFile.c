#pragma config(Sensor, in1,    pot1,           sensorPotentiometer)
#pragma config(Sensor, in2,    pot2,           sensorPotentiometer)
#pragma config(Sensor, in8,    expVoltage,     sensorAnalog)
#pragma config(Motor,  port2,           frontRight,    tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port3,           backRight,     tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port4,           frontLeft,     tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port5,           backLeft,      tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port6,           arm1,          tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port7,           arm2,          tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port8,           arm3,          tmotorVex393_MC29, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#pragma platform(VEX2)
#pragma competitionControl(Competition)
#include "Vex_Competition_Includes.c"
void waitForPress()
{
	while(nLCDButtons == 0){}
	wait1Msec(5);
}
void waitForRelease()
{
	while(nLCDButtons != 0){}
	wait1Msec(5);
}
int count = 0;
const short leftButton = 1;
const short centerButton = 2;
const short rightButton = 4;

void pre_auton()
{
	bStopTasksBetweenModes = true;

	clearLCDLine(0);
	clearLCDLine(1);
	while(nLCDButtons != centerButton)
	{
		switch(count){
		case 0:
			displayLCDCenteredString(0, "Autonomous 1");
			displayLCDCenteredString(1, "<         Enter        >");
			waitForPress();
			if(nLCDButtons == leftButton)
			{
				waitForRelease();
				count = 3;
			}
			else if(nLCDButtons == rightButton)
			{
				waitForRelease();
				count++;
			}
			break;
		case 1:
			displayLCDCenteredString(0, "Autonomous 2");
			displayLCDCenteredString(1, "<         Enter        >");
			waitForPress();
			if(nLCDButtons == leftButton)
			{
				waitForRelease();
				count--;
			}
			else if(nLCDButtons == rightButton)
			{
				waitForRelease();
				count++;
			}
			break;
		case 2:
			displayLCDCenteredString(0, "Autonomous 3");
			displayLCDCenteredString(1, "<         Enter        >");
			waitForPress();
			if(nLCDButtons == leftButton)
			{
				waitForRelease();
				count--;
			}
			else if(nLCDButtons == rightButton)
			{
				waitForRelease();
				count++;
			}
			break;
		case 3:
			displayLCDCenteredString(0, "Autonomous 4");
			displayLCDCenteredString(1, "<         Enter        >");
			waitForPress();
			if(nLCDButtons == leftButton)
			{
				waitForRelease();
				count--;
			}
			else if(nLCDButtons == rightButton)
			{
				waitForRelease();
				count = 0;
			}
			break;
		default:
			count = 0;
			break;
		}
	}
}
task autonomous()
{
	switch(count){
	case 0:
		displayLCDCenteredString(0, "Autonomous 1");
		displayLCDCenteredString(1, "is running!");
		motor[frontRight] = -127;
		motor[backRight] =  -127;
		motor[frontLeft] = 127;
		motor[backLeft] =  127;
		wait1Msec(350);
		motor[frontRight] = 127;
		motor[backRight] =  127;
		motor[frontLeft] = -127;
		motor[backLeft] =  -127;
		wait1Msec(2);
		motor[frontRight] = 127;
		motor[backRight] = 127;
		motor[frontLeft] = 127;
		motor[backLeft] =  127;
		break;
	case 1:
		displayLCDCenteredString(0, "Autonomous 2");
		displayLCDCenteredString(1, "is running!");
		motor[frontRight] = 127;
		motor[backRight] =  127;
		motor[frontLeft] = -127;
		motor[backLeft] =  -127;
		wait1Msec(350);
		motor[frontRight] = -127;
		motor[backRight] =  -127;
		motor[frontLeft] = 127;
		motor[backLeft] =  127;
		wait1Msec(2);
		motor[frontRight] = 127;
		motor[backRight] = 127;
		motor[frontLeft] = 127;
		motor[backLeft] =  127;
		break;
	case 2:
		displayLCDCenteredString(0, "Autonomous 3");
		displayLCDCenteredString(1, "is running!");
		break;
	case 3:
		displayLCDCenteredString(0, "Autonomous 4");
		displayLCDCenteredString(1, "is running!");
	default:
		displayLCDCenteredString(0, "No valid choice");
		displayLCDCenteredString(1, "was made!");
	}
}
task usercontrol()
{
	bLCDBacklight = true;
	string mainBattery, backupBattery;
	int X1=0,X2=0,Y1=0,threshold=10;
	int p1, p2;
	bool td = true;
	while (true)
	{
		p1=SensorValue[pot1]/15.45283018867925;
		p2=SensorValue[pot2]/15.45283018867925;
		//Driving code
		if(vexRT[Btn7U]==1){
			td=!td;
		}
		if(td==true){
			motor[port2] = vexRT(Ch3);
			motor[port3] = vexRT(Ch3);
			motor[port4] = vexRT(Ch2);
			motor[port5] = vexRT(Ch2);
			if(vexRT[Btn5D]==1)
			{
				motor[port2] =-127;
				motor[port3] = 127;
				motor[port4] = 127;
				motor[port5] = -127;
			}

			if(vexRT[Btn6D]==1){
				motor[port2] = 127;
				motor[port3] = -127;
				motor[port4] = -127;
				motor[port5] = 127;
			}
		}
		if(td==false){
			if(abs(vexRT[Ch3]) > threshold) Y1 = vexRT[Ch3];
			else Y1 = 0;
			if(abs(vexRT[Ch4]) > threshold)	X1 = vexRT[Ch4];
			else X1 = 0;
			if(abs(vexRT[Ch1]) > threshold)	X2 = vexRT[Ch1];
			else X2 = 0;
			motor[frontRight] = Y1 - X2 - X1;
			motor[backRight] =  Y1 - X2 + X1;
			motor[frontLeft] = Y1 + X2 + X1;
			motor[backLeft] =  Y1 + X2 - X1;
		}//end driving code
		//begin battery voltage code
		clearLCDLine(0);
		clearLCDLine(1);
		displayLCDString(0, 0, "Primary: ");
		sprintf(mainBattery, "%1.2f%c", nImmediateBatteryLevel/1000.0,'V');
		displayNextLCDString(mainBattery);
		displayLCDString(1, 0, "Backup: ");
		sprintf(backupBattery, "%1.2f%c", expVoltage/70, 'V');
		displayNextLCDString(backupBattery);
		//end batt voltage code
		//begin arm code
		if(vexRT[Btn5U]==1){
			motor[arm1]=-127;
			motor[arm2]=-127;
			motor[arm3]=-127;
			}if(vexRT[Btn6U]==1){
			motor[arm1]=-63;
			motor[arm2]=-63;
			motor[arm3]=-63;
			}else if(vexRT[Btn5U]==0&&vexRT[Btn6U]==0){
			motor[arm1]=0;
			motor[arm2]=0;
			motor[arm3]=0;
		}
		//end arm code
	}
}
